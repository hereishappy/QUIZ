<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scaffolding Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">
    <!-- Registration Screen -->
    <div id="registrationScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Scaffolding Quiz</h1>
                <p class="text-gray-600 mt-2">Test your knowledge</p>
            </div>

            <form id="registrationForm" class="space-y-6">


                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                    <input type="text" id="candidateName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all" placeholder="Enter your full name">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Number</label>
                    <input type="tel" id="candidatePhone" required pattern="[0-9]{10}" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all" placeholder="Enter 10-digit mobile number">
                </div>

                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                    Start Quiz
                </button>
            </form>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="hidden min-h-screen flex items-center justify-center">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-600">Loading questions...</p>
        </div>
    </div>

    <!-- Quiz Screen -->
    <div id="quizScreen" class="hidden min-h-screen p-4">
        <div class="max-w-2xl mx-auto">
            <!-- Progress Bar -->
            <div class="bg-white rounded-lg shadow-sm p-4 mb-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-gray-600">Question <span id="currentQuestion">1</span> of 20</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 5%"></div>
                </div>
            </div>

            <!-- Question Card -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-4">
                <h2 id="questionText" class="text-lg font-medium text-gray-800 mb-6 leading-relaxed"></h2>
                
                <div id="optionsContainer" class="space-y-3">
                    <!-- Options will be populated here -->
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex justify-end">
                <button id="nextBtn" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors">
                    Next
                </button>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="resultsScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md text-center fade-in">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Quiz Completed!</h2>
            <p class="text-gray-600 mb-6">Thank you for taking the quiz</p>
            
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <div class="text-3xl font-bold text-blue-600 mb-1" id="finalScore">0/20</div>
                <div class="text-sm text-gray-600">Final Score</div>
            </div>

            <button onclick="location.reload()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                Take Quiz Again
            </button>
        </div>
    </div>

    <script>
        // App State
        let currentQuestionIndex = 0;
        let questions = [];
        let userAnswers = [];
        let candidateInfo = {};



        // Fetch questions from Google Sheets
        async function fetchQuestions() {
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbwXQEl036KLudzHF_2QW1pw_ro0_DwPmCl-8xalXpmTStERK73cx6yt0kNMPj-ZMx-k/exec?action=getQuestions');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to fetch questions');
                }
                
                // Convert to expected format
                let fetchedQuestions = data.questions.map(q => ({
                    question: q.question,
                    options: [q.optionA, q.optionB, q.optionC, q.optionD],
                    correct: q.correct
                }));
                
                // Shuffle and limit to 20 questions
                questions = fetchedQuestions.sort(() => Math.random() - 0.5).slice(0, 20);
                
                return questions;
            } catch (error) {
                console.error('Error fetching questions:', error);
                alert('Error loading questions. Please check your internet connection and try again.');
                return [];
            }
        }

        // Save quiz results to Google Sheets
        async function saveQuizResult(score) {
            try {
                console.log('Sending data to Google Sheets:', {
                    name: candidateInfo.name,
                    contact: candidateInfo.phone,
                    marks: score
                });
                
                const response = await fetch('https://script.google.com/macros/s/AKfycbwXQEl036KLudzHF_2QW1pw_ro0_DwPmCl-8xalXpmTStERK73cx6yt0kNMPj-ZMx-k/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'saveResult',
                        name: candidateInfo.name,
                        contact: candidateInfo.phone,
                        marks: score
                    })
                });
                
                console.log('Response status:', response.status);
                const result = await response.json();
                console.log('Response data:', result);
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to save result');
                }
                
                return result;
            } catch (error) {
                console.error('Error saving result:', error);
                throw error;
            }
        }



        // Display question
        function displayQuestion() {
            const question = questions[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            
            const progressPercent = ((currentQuestionIndex + 1) / 20) * 100;
            document.getElementById('progressBar').style.width = progressPercent + '%';
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionLetter = String.fromCharCode(65 + index); // A, B, C, D
                const isSelected = userAnswers[currentQuestionIndex] === optionLetter;
                
                const optionDiv = document.createElement('div');
                optionDiv.className = `p-4 border-2 rounded-lg cursor-pointer transition-all ${
                    isSelected ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-blue-300'
                }`;
                optionDiv.innerHTML = `
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="answer" value="${optionLetter}" class="sr-only" ${isSelected ? 'checked' : ''}>
                        <div class="w-5 h-5 border-2 rounded-full mr-3 flex items-center justify-center ${
                            isSelected ? 'border-blue-500 bg-blue-500' : 'border-gray-300'
                        }">
                            ${isSelected ? '<div class="w-2 h-2 bg-white rounded-full"></div>' : ''}
                        </div>
                        <span class="text-gray-800">${optionLetter}. ${option}</span>
                    </label>
                `;
                
                optionDiv.addEventListener('click', () => {
                    userAnswers[currentQuestionIndex] = optionLetter;
                    displayQuestion(); // Refresh to show selection
                });
                
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update navigation button
            document.getElementById('nextBtn').textContent = 
                currentQuestionIndex === 19 ? 'Submit Quiz' : 'Next';
        }

        // Submit quiz and calculate results
        async function submitQuiz() {
            try {
                let score = 0;
                questions.forEach((question, index) => {
                    if (userAnswers[index] === question.correct) {
                        score++;
                    }
                });
                
                // Save results to Google Sheets
                console.log('Saving quiz result...');
                await saveQuizResult(score);
                console.log('Quiz result saved successfully');
                
                // Show results
                document.getElementById('finalScore').textContent = `${score}/20`;
                showScreen('resultsScreen');
                
            } catch (error) {
                console.error('Error submitting quiz:', error);
                alert('There was an error submitting your quiz. Your score is calculated but may not be saved.');
                
                // Still show results even if saving failed
                let score = 0;
                questions.forEach((question, index) => {
                    if (userAnswers[index] === question.correct) {
                        score++;
                    }
                });
                document.getElementById('finalScore').textContent = `${score}/20`;
                showScreen('resultsScreen');
            }
        }

        // Show specific screen
        function showScreen(screenId) {
            const screens = ['registrationScreen', 'loadingScreen', 'quizScreen', 'resultsScreen'];
            screens.forEach(screen => {
                document.getElementById(screen).classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        // Event Listeners
        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            candidateInfo = {
                name: document.getElementById('candidateName').value,
                phone: document.getElementById('candidatePhone').value
            };
            
            showScreen('loadingScreen');
            
            try {
                await fetchQuestions();
                if (questions.length === 0) {
                    throw new Error('No questions loaded');
                }
                userAnswers = new Array(20).fill(null);
                showScreen('quizScreen');
                displayQuestion();
            } catch (error) {
                alert('Failed to load quiz. Please try again.');
                showScreen('registrationScreen');
            }
        });

        document.getElementById('nextBtn').addEventListener('click', async () => {
            if (currentQuestionIndex < 19) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                if (confirm('Are you sure you want to submit the quiz?')) {
                    // Show loading state
                    document.getElementById('nextBtn').textContent = 'Submitting...';
                    document.getElementById('nextBtn').disabled = true;
                    
                    await submitQuiz();
                }
            }
        });


    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97abb0d15496913b',t:'MTc1NzEzNzg0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
